generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Prisma Schema

model PhoneNumber {
  id              String   @id @default(cuid())
  phoneNumber     String   @unique
  friendlyName    String?
  areaCode        String
  twilioSid       String   @unique
  campaignSid     String?
  messagingServiceSid String?
  purchaseDate    DateTime @default(now())
  status          String   @default("active") // active, released, error
  ghlAssignedTo   String?  // GHL user ID
  ghlSyncedAt     DateTime?
  
  callLogs        CallLog[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model CallLog {
  id              String   @id @default(cuid())
  phoneNumberId   String
  phoneNumber     PhoneNumber @relation(fields: [phoneNumberId], references: [id])
  
  callSid         String   @unique
  direction       String   // inbound, outbound
  from            String
  to              String
  status          String   // completed, failed, busy, no-answer
  duration        Int?     // in seconds
  startTime       DateTime
  endTime         DateTime?
  errorCode       String?
  errorMessage    String?
  
  createdAt       DateTime @default(now())
}

model GHLUser {
  id              String   @id @default(cuid())
  ghlUserId       String   @unique
  name            String
  email           String?
  role            String?
assignedNumbers String?  // Comma-separated phone number IDs (for SQLite)
  
  lastSyncedAt    DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model SystemConfig {
  id              String   @id @default(cuid())
  key             String   @unique
  value           String
  description     String?
  
  updatedAt       DateTime @updatedAt
}

model Closer {
  id                    String   @id @default(cuid())
  firstName             String
  lastName              String
  email                 String   @unique
  phoneNumber           String?

  // Account IDs across platforms
  googleWorkspaceId     String?
  calendlyUserId        String?
  zoomUserId            String?
  ghlUserId             String?
  twilioNumberSid       String?
  twilioPhoneNumber     String?  // The 650 number assigned

  // Status tracking
  status                String   @default("active") // active, offboarding, offboarded
  onboardedAt           DateTime @default(now())
  offboardedAt          DateTime?

  // Metadata
  notes                 String?

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model OnboardingRecord {
  id                    String   @id @default(cuid())

  // User info
  firstName             String
  lastName              String
  personalEmail         String
  workEmail             String?  // Generated @tjr-trades.com email

  // Overall status
  status                String   @default("in_progress") // in_progress, completed, failed
  currentStep           Int      @default(1)

  // Step statuses: pending, in_progress, completed, failed, skipped
  googleWorkspaceStatus String   @default("pending")
  googleWorkspaceError  String?

  zoomStatus            String   @default("pending")
  zoomError             String?

  calendlyStatus        String   @default("pending")
  calendlyError         String?

  ghlStatus             String   @default("pending")
  ghlError              String?
  ghlUserId             String?

  twilioStatus          String   @default("pending")
  twilioError           String?
  twilioNumber          String?

  // Timestamps
  startedAt             DateTime @default(now())
  completedAt           DateTime?

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

// ========================================
// MODELS FOR EXISTING POSTGRESQL TABLES
// ========================================

model SetterCall {
  id                String   @id @default(uuid())
  callSid           String?  @map("call_sid")
  from              String?
  to                String?
  status            String?
  duration          Int?
  startTime         DateTime? @map("start_time")
  endTime           DateTime? @map("end_time")
  direction         String?
  answeredBy        String?  @map("answered_by")
  phoneNumberSid    String?  @map("phone_number_sid")
  price             String?
  priceUnit         String?  @map("price_unit")
  setter            String?  // Setter email or identifier
  setterId          String?  @map("setter_id")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@map("setter_calls")
}

model BookedCall {
  id                String   @id @default(uuid())
  contactName       String?  @map("contact_name")
  contactEmail      String?  @map("contact_email")
  contactPhone      String?  @map("contact_phone")
  eventType         String?  @map("event_type")
  eventStartTime    DateTime? @map("event_start_time")
  eventEndTime      DateTime? @map("event_end_time")
  eventStatus       String?  @map("event_status")
  setter            String?  // Setter who booked it
  setterId          String?  @map("setter_id")
  calendlyEventUri  String?  @map("calendly_event_uri")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@map("booked_calls")
}

model Setter {
  id                String   @id @default(uuid())
  name              String?
  email             String?  @unique
  phoneNumber       String?  @map("phone_number")
  ghlUserId         String?  @map("ghl_user_id")
  status            String?  @default("active")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@map("setters")
}

model Sale {
  id                String   @id @default(uuid())
  customerName      String?  @map("customer_name")
  customerEmail     String?  @map("customer_email")
  amount            Float?
  status            String?  // completed, pending, refunded, etc.
  paymentMethod     String?  @map("payment_method")
  product           String?
  closer            String?  // Closer who made the sale
  closerId          String?  @map("closer_id")
  saleDate          DateTime? @map("sale_date")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@map("sales")
}